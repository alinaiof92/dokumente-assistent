<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{background:#0a0f1e;color:#f1f5f9;font-family:'Cairo','Tahoma',sans-serif;min-height:100vh;padding:1.5rem 1rem;direction:rtl}
  .wrap{max-width:800px;margin:0 auto}
  header{text-align:center;padding:2rem 0}
  h1{font-size:clamp(1.8rem,5vw,2.8rem);font-weight:900;margin-bottom:.8rem}
  h1 span{background:linear-gradient(135deg,#3b82f6,#10b981);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .sub{color:#94a3b8;font-size:.95rem;line-height:1.7;max-width:480px;margin:0 auto}
  .card{background:#111827;border:1px solid rgba(59,130,246,.2);border-radius:20px;padding:1.5rem;box-shadow:0 25px 50px rgba(0,0,0,.4);margin-bottom:1rem}
  .label{font-size:.82rem;color:#94a3b8;margin-bottom:.6rem}

  /* Tabs */
  .tabs{display:flex;border-bottom:1px solid rgba(59,130,246,.15);margin-bottom:1.25rem}
  .tab{flex:1;padding:.9rem;border:none;background:none;color:#94a3b8;cursor:pointer;font-family:inherit;font-size:.9rem;border-bottom:2px solid transparent;transition:all .2s}
  .tab.on{color:#3b82f6;border-bottom-color:#3b82f6;background:rgba(59,130,246,.05)}

  textarea{width:100%;background:#1a2235;border:1px solid rgba(59,130,246,.2);border-radius:12px;padding:1rem;color:#f1f5f9;font-size:.95rem;resize:vertical;min-height:180px;outline:none;direction:ltr;text-align:left;line-height:1.6;font-family:monospace;transition:border-color .3s}
  textarea:focus{border-color:#3b82f6}

  /* Upload */
  .upload{border:2px dashed rgba(59,130,246,.3);border-radius:12px;padding:2.5rem 1.5rem;text-align:center;cursor:pointer;transition:all .3s;background:#1a2235}
  .upload:hover{border-color:#3b82f6;background:rgba(59,130,246,.05)}
  .upload-icon{font-size:2.5rem;margin-bottom:.75rem}
  .upload-text{color:#94a3b8;font-size:.9rem;line-height:1.6}
  .upload-text strong{color:#3b82f6}
  #preview{max-width:100%;max-height:280px;border-radius:10px;margin-top:1rem;border:1px solid rgba(59,130,246,.2);display:none}
  .del-btn{margin-top:.5rem;background:none;border:1px solid rgba(255,255,255,.1);color:#94a3b8;border-radius:8px;padding:.3rem .8rem;cursor:pointer;font-size:.8rem;font-family:inherit;display:none}

  .cats{display:flex;flex-wrap:wrap;gap:.4rem;margin-top:1.25rem}
  .cat{cursor:pointer;padding:.35rem .85rem;border-radius:100px;font-size:.78rem;border:1px solid rgba(59,130,246,.2);background:#1a2235;color:#94a3b8;transition:all .2s;font-family:inherit}
  .cat:hover,.cat.on{background:rgba(59,130,246,.2);border-color:#3b82f6;color:#3b82f6}
  .btn{width:100%;background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border:none;border-radius:12px;padding:1rem;font-family:inherit;font-size:1.05rem;font-weight:700;cursor:pointer;transition:all .3s;margin-top:1rem}
  .btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 30px rgba(59,130,246,.4)}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .error{margin-top:1rem;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);border-radius:10px;padding:.85rem 1rem;color:#f87171;font-size:.9rem;display:none}
  .spinner{display:none;text-align:center;padding:2.5rem}
  .spin{width:48px;height:48px;border:3px solid rgba(59,130,246,.2);border-top-color:#3b82f6;border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 1rem}
  .result-card{display:none;background:#111827;border:1px solid rgba(16,185,129,.3);border-radius:20px;overflow:hidden;animation:up .5s ease;margin-top:1.5rem}
  .result-head{background:linear-gradient(135deg,rgba(16,185,129,.12),rgba(59,130,246,.08));padding:1.25rem 1.5rem;border-bottom:1px solid rgba(16,185,129,.2);display:flex;align-items:center;justify-content:space-between}
  .result-title{color:#10b981;font-weight:700}
  .result-body{padding:1.5rem;line-height:2;font-size:.98rem;white-space:pre-wrap;color:#e2e8f0}
  .result-foot{padding:1rem 1.5rem;border-top:1px solid rgba(255,255,255,.05);display:flex;gap:.75rem;flex-wrap:wrap}
  .sm-btn{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);color:#94a3b8;border-radius:8px;padding:.5rem 1rem;cursor:pointer;font-size:.82rem;font-family:inherit}
  .sm-btn.blue{background:rgba(59,130,246,.1);border-color:rgba(59,130,246,.2);color:#3b82f6}
  footer{text-align:center;padding:2rem 0 1rem;color:#475569;font-size:.75rem}
  @keyframes spin{to{transform:rotate(360deg)}}
  @keyframes up{from{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Ù…Ø³Ø§Ø¹Ø¯ <span>Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ©</span></h1>
    <p class="sub">Ø§Ù†Ø³Ø® Ø£ÙŠ Ø±Ø³Ø§Ù„Ø© Ø£Ù„Ù…Ø§Ù†ÙŠØ© Ø±Ø³Ù…ÙŠØ© Ø£Ùˆ Ø­Ù…Ù‘Ù„ ØµÙˆØ±ØªÙ‡Ø§ â€” Ø³Ù†Ø´Ø±Ø­ Ù„Ùƒ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ø§Ø°Ø§ ØªØ¹Ù†ÙŠ ÙˆÙ…Ø§Ø°Ø§ ØªÙØ¹Ù„</p>
  </header>

  <div class="card">
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab on" onclick="switchTab('text', this)">ğŸ“ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
      <button class="tab" onclick="switchTab('image', this)">ğŸ“· ØµÙˆØ±Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
    </div>

    <!-- Text panel -->
    <div id="panel-text">
      <div class="label">Ø§Ù†Ø³Ø® Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‡Ù†Ø§</div>
      <textarea id="txt" placeholder="Sehr geehrte/r Herr/Frau...&#10;&#10;Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ© Ù‡Ù†Ø§..."></textarea>
    </div>

    <!-- Image panel -->
    <div id="panel-image" style="display:none">
      <div class="label">Ø­Ù…Ù‘Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©</div>
      <div class="upload" id="uploadArea" onclick="document.getElementById('fileInput').click()"
           ondragover="event.preventDefault()" ondrop="handleDrop(event)">
        <div class="upload-icon">ğŸ“„</div>
        <div class="upload-text"><strong>Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©</strong><br>Ø£Ùˆ Ø§Ø³Ø­Ø¨ ÙˆØ£ÙÙ„Øª Ù‡Ù†Ø§<br><small style="opacity:.6">JPG, PNG, WebP</small></div>
        <img id="preview" />
      </div>
      <button class="del-btn" id="delBtn" onclick="clearImage()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©</button>
      <input type="file" id="fileInput" accept="image/*" style="display:none" onchange="handleFile(event)">
    </div>

    <!-- Categories -->
    <div style="margin-top:1.25rem">
      <div class="label">ğŸ·ï¸ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</div>
      <div class="cats">
        <button class="cat" onclick="pickCat(this)">Jobcenter / Ø¨ÙˆÙ„ÙŠØ´ÙŠØª</button>
        <button class="cat" onclick="pickCat(this)">Finanzamt / Ø¶Ø±ÙŠØ¨Ø©</button>
        <button class="cat" onclick="pickCat(this)">Krankenkasse / ØªØ£Ù…ÙŠÙ† ØµØ­ÙŠ</button>
        <button class="cat" onclick="pickCat(this)">Bank / Ø¨Ù†Ùƒ</button>
        <button class="cat" onclick="pickCat(this)">Vermieter / Ù…Ø§Ù„Ùƒ Ø§Ù„Ø³ÙƒÙ†</button>
        <button class="cat" onclick="pickCat(this)">AuslÃ¤nderbehÃ¶rde / Ø¥Ù‚Ø§Ù…Ø©</button>
        <button class="cat" onclick="pickCat(this)">Schule / Ù…Ø¯Ø±Ø³Ø©</button>
        <button class="cat" onclick="pickCat(this)">Ø£Ø®Ø±Ù‰</button>
      </div>
    </div>

    <div class="error" id="err"></div>
    <button class="btn" id="analyzeBtn" onclick="analyze()">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ´Ø±Ø­Ù‡Ø§ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
  </div>

  <div class="spinner" id="spinner">
    <div class="spin"></div>
    <div style="color:#94a3b8">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©...<br><small style="opacity:.6">Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†Ù ÙÙ‚Ø·</small></div>
  </div>

  <div class="result-card" id="resultCard">
    <div class="result-head">
      <span class="result-title">âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø±Ø³Ø§Ù„ØªÙƒ</span>
      <span id="badge" style="border-radius:100px;padding:.25rem .75rem;font-size:.78rem;font-weight:600"></span>
    </div>
    <div class="result-body" id="resultBody"></div>
    <div class="result-foot">
      <button class="sm-btn" onclick="resetAll()">ğŸ”„ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
      <button class="sm-btn blue" onclick="navigator.clipboard?.writeText(document.getElementById('resultBody').textContent)">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
    </div>
  </div>

  <footer>Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ© â€¢ Ù„ÙŠØ³ Ø§Ø³ØªØ´Ø§Ø±Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø±Ø³Ù…ÙŠØ©</footer>
</div>

<script>
  let selectedCat = "";
  let activeTab = "text";
  let imageDataUrl = "";

  function switchTab(tab, btn) {
    activeTab = tab;
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("on"));
    btn.classList.add("on");
    document.getElementById("panel-text").style.display = tab === "text" ? "block" : "none";
    document.getElementById("panel-image").style.display = tab === "image" ? "block" : "none";
  }

  function pickCat(el) {
    document.querySelectorAll(".cat").forEach(c => c.classList.remove("on"));
    selectedCat = selectedCat === el.textContent ? "" : el.textContent;
    if (selectedCat) el.classList.add("on");
  }

  function handleFile(e) { processFile(e.target.files[0]); }
  function handleDrop(e) { e.preventDefault(); processFile(e.dataTransfer.files[0]); }

  function processFile(file) {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      imageDataUrl = e.target.result;
      document.getElementById("preview").src = imageDataUrl;
      document.getElementById("preview").style.display = "block";
      document.getElementById("delBtn").style.display = "inline-block";
    };
    reader.readAsDataURL(file);
  }

  function clearImage() {
    imageDataUrl = "";
    document.getElementById("preview").style.display = "none";
    document.getElementById("delBtn").style.display = "none";
    document.getElementById("fileInput").value = "";
  }

  async function analyze() {
    const err = document.getElementById("err");
    err.style.display = "none";
    document.getElementById("resultCard").style.display = "none";

    // Validate
    if (activeTab === "text" && !document.getElementById("txt").value.trim()) {
      err.textContent = "Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©"; err.style.display = "block"; return;
    }
    if (activeTab === "image" && !imageDataUrl) {
      err.textContent = "Ù…Ù† ÙØ¶Ù„Ùƒ Ø­Ù…Ù‘Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©"; err.style.display = "block"; return;
    }

    document.getElementById("analyzeBtn").disabled = true;
    document.getElementById("spinner").style.display = "block";

    try {
      const body = { category: selectedCat };
      if (activeTab === "text") {
        body.text = document.getElementById("txt").value.trim();
      } else {
        body.image = imageDataUrl; // send full base64 data URL
      }

      const res = await fetch("/api/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      const data = await res.json();
      if (data.error) throw new Error(data.error);
      showResult(data.result);

    } catch(e) {
      err.textContent = "Ø®Ø·Ø£: " + e.message;
      err.style.display = "block";
    } finally {
      document.getElementById("analyzeBtn").disabled = false;
      document.getElementById("spinner").style.display = "none";
    }
  }

  function showResult(text) {
    const badge = document.getElementById("badge");
    if (text.includes("Ø¹Ø§Ø¬Ù„ Ø¬Ø¯Ø§Ù‹") || text.includes("Ø¹Ø§Ø¬Ù„ Ø¬Ø¯Ø§")) {
      badge.textContent = "ğŸ”´ Ø¹Ø§Ø¬Ù„ Ø¬Ø¯Ø§Ù‹";
      badge.style.cssText = "background:rgba(239,68,68,.15);color:#f87171;border:1px solid rgba(239,68,68,.3);border-radius:100px;padding:.25rem .75rem;font-size:.78rem;font-weight:600";
    } else if (text.includes("Ù…Ù‡Ù…")) {
      badge.textContent = "ğŸŸ¡ Ù…Ù‡Ù…";
      badge.style.cssText = "background:rgba(245,158,11,.15);color:#fbbf24;border:1px solid rgba(245,158,11,.3);border-radius:100px;padding:.25rem .75rem;font-size:.78rem;font-weight:600";
    } else {
      badge.textContent = "ğŸŸ¢ Ø¹Ø§Ø¯ÙŠ";
      badge.style.cssText = "background:rgba(16,185,129,.15);color:#34d399;border:1px solid rgba(16,185,129,.3);border-radius:100px;padding:.25rem .75rem;font-size:.78rem;font-weight:600";
    }
    document.getElementById("resultBody").textContent = text;
    document.getElementById("resultCard").style.display = "block";
    document.getElementById("resultCard").scrollIntoView({ behavior: "smooth" });
  }

  function resetAll() {
    document.getElementById("txt").value = "";
    document.getElementById("resultCard").style.display = "none";
    document.getElementById("err").style.display = "none";
    selectedCat = ""; imageDataUrl = "";
    document.querySelectorAll(".cat").forEach(c => c.classList.remove("on"));
    clearImage();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }
</script>
</body>
</html>
